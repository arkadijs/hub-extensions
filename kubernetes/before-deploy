#!/bin/bash -e
# shellcheck disable=SC2068,SC2086,SC2155

HUB_HOME="${HUB_HOME:-$(dirname "$0")}"
HUB_WORKDIR="${HUB_WORKDIR:-$(pwd)}"
HUB_EXTENSION="$(basename "$0" | sed 's/-/ /g')"
PATH="$HUB_HOME:$HUB_HOME/bin:$HUB_WORKDIR:$HUB_WORKDIR/bin:$PATH"
export PATH

usage() {
  cat << EOF
Check if kubernetes cluster has been reachable
EOF
}

if test ! -f ".env"; then
  echo "Error: cannot find .env file. Please run 'hub configure'"
  exit 1
fi

set +a
eval "$(dotenv -f $HUB_WORKDIR/.env "export")"
set -a

hub_kubeconfig=$($dotenv get "HUB_KUBECONFIG")
if test -n "$hub_kubeconfig"; then
  KUBECONFIG=$($dotenv get "HUB_KUBECONFIG" --default "$KUBECONFIG")
  export KUBECONFIG
  echo "* Using kubeconfig: $KUBECONFIG"
fi

echo -n "* Checking connectivity to cluster: "
if kubectl cluster-info > /dev/null; then
  echo "Connected"
else
  exit 2
fi
